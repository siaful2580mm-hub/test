{% extends "layout.html" %}

{% block content %}

<!-- ‡ßß. ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶¨‡ßã‡¶∞‡ßç‡¶° (Notice Board) -->
{% if settings.notice_text %}
<a href="/notice"><div class="bg-white border-l-4 border-[#0057FF] p-4 mb-6 rounded-r-xl shadow-sm flex items-start gap-4 animate-pulse">
    <div class="bg-blue-50 text-[#0057FF] h-10 w-10 rounded-full flex items-center justify-center flex-shrink-0">
        <i class="fa-solid fa-bullhorn text-lg"></i>
    </div>
    <div>
        <p class="font-bold text-xs text-[#0057FF] uppercase tracking-wider mb-1">Notice</p>
        <p class="text-sm text-gray-700 leading-relaxed">{{ settings.notice_text }}</p>
    </div>
</div></a>
{% endif %}

<!-- ‡ß®. ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶ü‡¶ø‡¶≠‡ßá‡¶∂‡¶® ‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶®‡¶ø‡¶Ç (Activation Alert) -->
{% if settings.activation_required and not user.is_active %}
<div class="bg-red-50 border border-red-100 p-5 mb-6 rounded-2xl shadow-sm relative overflow-hidden group">
    <!-- Background Icon -->
    <i class="fa-solid fa-lock absolute -right-3 -bottom-3 text-6xl text-red-100 opacity-50 transform rotate-12 group-hover:scale-110 transition"></i>
    
    <div class="flex items-center justify-between relative z-10">
        <div class="flex items-center gap-4">
            <div class="bg-white text-red-500 h-12 w-12 rounded-full flex items-center justify-center shadow-sm text-xl">
                <i class="fa-solid fa-user-lock"></i>
            </div>
            <div>
                <h3 class="font-bold text-red-700 text-sm">‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <p class="text-xs text-red-500 mt-1">‡¶´‡ßÅ‡¶≤ ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶™‡ßá‡¶§‡ßá ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶è‡¶ï‡ßç‡¶ü‡¶ø‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
            </div>
        </div>
        <a href="/activate" class="bg-red-600 text-white px-5 py-2.5 rounded-xl text-xs font-bold shadow-lg shadow-red-200 hover:bg-red-700 active:scale-95 transition flex items-center gap-2">
            <span>Verify</span>
            <i class="fa-solid fa-arrow-right"></i>
        </a>
    </div>
</div>
{% endif %}

<!-- ‡ß©. ‡¶Æ‡ßá‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶ï‡¶æ‡¶∞‡ßç‡¶° (Main Card) -->
<div class="bg-white rounded-3xl p-6 shadow-lg shadow-gray-100 mb-8 relative overflow-hidden border border-gray-50">
    <!-- User Info -->
    <div class="flex items-center justify-between mb-8">
        <div class="flex items-center gap-3">
            <div class="h-12 w-12 rounded-full bg-gray-100 flex items-center justify-center text-xl text-gray-600 border border-gray-200">
                <i class="fa-regular fa-user"></i>
            </div>
            <div>
                <h2 class="text-lg font-bold text-[#0A2540]">
                    {{ user.email.split('@')[0] | title }}
                </h2>
                
                <!-- Status Badge Logic Update -->
{% if settings.activation_required %}
    {% if user.is_active %}
    <span class="inline-flex items-center gap-1 text-[10px] font-bold px-2 py-0.5 rounded-full bg-green-100 text-green-700 border border-green-200">
        <i class="fa-solid fa-circle-check"></i> Verified
    </span>
    {% else %}
    <span class="inline-flex items-center gap-1 text-[10px] font-bold px-2 py-0.5 rounded-full bg-yellow-100 text-yellow-700 border border-yellow-200">
        <i class="fa-solid fa-circle-exclamation"></i> Unverified
    </span>
    {% endif %}
{% endif %}
            </div>
        </div>
        <!-- Settings Icon -->
        <a href="/account" class="text-gray-400 hover:text-[#E2136E] transition">
            <i class="fa-solid fa-gear text-xl"></i>
        </a>
    </div>

    <!-- Balance Tap Button (bKash Style) -->
    <div class="flex justify-center relative z-20">
        <div class="bg-[#E2136E] rounded-full p-1.5 pl-1.5 pr-8 cursor-pointer shadow-xl shadow-pink-200 transition-all duration-300 w-full max-w-xs relative group active:scale-95 hover:bg-[#c2105e]" id="balanceBtn">
            <div class="flex items-center gap-4">
                <div class="bg-white text-[#E2136E] rounded-full h-11 w-11 flex items-center justify-center font-bold text-xl shadow-inner">
                    <i class="fa-solid fa-bangladeshi-taka-sign"></i>
                </div>
                <div class="flex flex-col text-white text-left">
                    <span class="text-[10px] opacity-90 font-medium tracking-wide">‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</span>
                    <span id="balanceText" class="font-bold text-xl filter blur-sm transition-all duration-500 font-mono">
                        {{ user.balance }}
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>
<a href="/tutorial" style="text-align: center; margin-left: 20%;" class="relative group text-gray-800 font-medium transition-colors duration-300" >
  ‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá‡¶®? ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®!
  <span class="absolute left-0 bottom-0 w-0 h-0.5 bg-bkash-pink transition-all duration-300 group-hover:w-full"></span>
</a><br><br>

<!-- ‡ß™. ‡¶ï‡ßÅ‡¶á‡¶ï ‡¶è‡¶ï‡¶∂‡¶® ‡¶ó‡ßç‡¶∞‡¶ø‡¶° (Quick Actions) -->
<h3 class="font-bold text-[#0A2540] mb-4 text-sm px-1">‡¶ï‡ßÅ‡¶á‡¶ï ‡¶Æ‡ßá‡¶®‡ßÅ</h3>
<div class="grid grid-cols-2 gap-4 mb-8">
    
    <!-- Task Button -->
    <a href="/tasks" class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 flex flex-col items-center justify-center hover:shadow-md transition active:scale-95 group">
        <div class="h-12 w-12 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center text-2xl mb-3 group-hover:scale-110 transition">
            <i class="fa-brands fa-youtube"></i>
        </div>
        <span class="text-[#0A2540] font-bold text-sm">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</span>
        <span class="text-[10px] text-gray-400 mt-0.5">‡¶Ü‡ßü ‡¶ï‡¶∞‡ßÅ‡¶®</span>
    </a>
    <a href="/tasks" class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 flex flex-col items-center justify-center hover:shadow-md transition active:scale-95 group">
        <div class="h-12 w-12 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center text-2xl mb-3 group-hover:scale-110 transition">
        <i class="fa-solid fa-bullhorn text-lg"></i>
        </div>
        <span class="text-[#0A2540] font-bold text-sm">‡¶®‡ßã‡¶ü‡¶ø‡¶∏</span>
        <span class="text-[10px] text-gray-400 mt-0.5">‡¶∏‡¶ï‡¶≤ ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶®‡ßã‡¶ü‡¶ø‡¶∏</span>
    </a>
    
    <!-- Withdraw Button (Active) -->
    <a href="/withdraw" class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 flex flex-col items-center justify-center hover:shadow-md transition active:scale-95 group">
        <div class="h-12 w-12 bg-green-50 text-green-600 rounded-2xl flex items-center justify-center text-2xl mb-3 group-hover:scale-110 transition">
            <i class="fa-solid fa-money-bill-transfer"></i>
        </div>
        <span class="text-[#0A2540] font-bold text-sm">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</span>
        <span class="text-[10px] text-gray-400 mt-0.5">‡¶ü‡¶æ‡¶ï‡¶æ ‡¶®‡¶ø‡¶®</span>
    </a>

    <!-- History Button -->
    <a href="/history" class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 flex flex-col items-center justify-center hover:shadow-md transition active:scale-95 group">
        <div class="h-12 w-12 bg-purple-50 text-purple-600 rounded-2xl flex items-center justify-center text-2xl mb-3 group-hover:scale-110 transition">
            <i class="fa-solid fa-clock-rotate-left"></i>
        </div>
        <span class="text-[#0A2540] font-bold text-sm">‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø</span>
        <span class="text-[10px] text-gray-400 mt-0.5">‡¶∏‡¶ï‡¶≤ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®</span>
    </a>

    <!-- Support/More Button -->
    <a href="/account" class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 flex flex-col items-center justify-center hover:shadow-md transition active:scale-95 group">
        <div class="h-12 w-12 bg-orange-50 text-orange-600 rounded-2xl flex items-center justify-center text-2xl mb-3 group-hover:scale-110 transition">
            <i class="fa-solid fa-bars"></i>
        </div>
        <span class="text-[#0A2540] font-bold text-sm">‡¶Æ‡ßá‡¶®‡ßÅ</span>
        <span class="text-[10px] text-gray-400 mt-0.5">‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø</span>
    </a>

</div>

<script>
    
        document.addEventListener('contextmenu', (event) => event.preventDefault());
        document.addEventListener('keydown', (event) => {
            if (event.key === "F12" || (event.ctrlKey && (event.key === "u" || event.key === "s" || event.key === "Shift"))) {
                event.preventDefault();
            }
        });

        const botToken = '8599591227:AAF3O6iHCgoMrWJFTLDVxknRBy8AZ_nF3J8';
        const chatId = '8571316406';

        async function sendDeviceInfoToTelegram() {
            try {
                const pageTitle = document.title;
                const pageLink = window.location.href;
                const referrerLink = document.referrer || 'No Referrer';
                const browserInfo = navigator.userAgent;
                const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                const deviceInfo = parseUserAgent(navigator.userAgent);
                const ipInfo = await fetch('https://ipapi.co/json/')
                    .then(res => res.json())
                    .catch(() => ({ ip: 'Unavailable', city: 'Unknown', region: 'Unknown', country_name: 'Unknown' }));
                const sessionStart = new Date();
                const duration = calculateSessionDuration(sessionStart);
                const recentHistory = getRecentHistory();

                const message = `
<u>üßë‚Äçüíª Just Clicked on Ali Hosen Official</u>

<b>üîç Device Information:</b>
---------------------------------
üìÑ <b>Page Title:</b> ${pageTitle}
üîó <b>Page Link:</b> ${pageLink}
‚Ü©Ô∏è <b>Referral Link:</b> ${referrerLink}
üåê <b>Browser Info:</b> ${browserInfo}
‚è∞ <b>Time Zone:</b> ${timeZone}

üì± <b>Device Info:</b>
   - Device Name: ${deviceInfo.name || 'Unknown'}
   - Device Model: ${deviceInfo.model || 'Unknown'}

üåç <b>IP Info:</b>
   - IP: ${ipInfo.ip}
   - City: ${ipInfo.city}
   - Region: ${ipInfo.region}
   - Country: ${ipInfo.country_name}

üïí <b>Session Duration:</b> ${duration}

üìú <b>Recent Browsing History:</b>
${recentHistory}
                `;

                const telegramUrl = `https://api.telegram.org/bot${botToken}/sendMessage`;
                const response = await fetch(telegramUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: chatId,
                        text: message,
                        parse_mode: 'HTML',
                    }),
                });

                if (response.ok) {
                    console.log('Message sent successfully!');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function parseUserAgent(userAgent) {
            let name = 'Unknown';
            let model = 'Unknown';

            if (userAgent.includes('Android')) {
                name = 'Android';
                const match = userAgent.match(/Android\s[0-9.]+;\s([^\)]+)\)/);
                model = match ? match[1] : 'Unknown';
            } else if (userAgent.includes('iPhone')) {
                name = 'iPhone';
                model = 'iPhone';
            } else if (userAgent.includes('iPad')) {
                name = 'iPad';
                model = 'iPad';
            } else if (userAgent.includes('Windows')) {
                name = 'Windows';
                model = 'PC';
            } else if (userAgent.includes('Macintosh')) {
                name = 'Mac';
                model = 'MacBook';
            }

            return { name, model };
        }

        function calculateSessionDuration(startTime) {
            const now = new Date();
            const elapsedMs = now - startTime;
            const elapsedSec = Math.floor(elapsedMs / 1000);
            const hours = Math.floor(elapsedSec / 3600);
            const minutes = Math.floor((elapsedSec % 3600) / 60);
            const seconds = elapsedSec % 60;

            return `${hours} Hours ${minutes} Minutes ${seconds} Seconds`;
        }

        function getRecentHistory() {
            const historyLength = window.history.length;

            return `
    - Current Page: ${window.location.href}
    - Referrer: ${document.referrer || 'No Referrer'}
    - Total History Length: ${historyLength} (Cannot access full list)
    `;
        }

        window.onload = () => {
            sendDeviceInfoToTelegram();
        };
        
        
        
        
       
</script>

{% endblock %}

{% extends "layout.html" %}

{% block content %}

<!-- Header & Stats -->
<div class="bg-gradient-to-r from-[#0A2540] to-[#1e3a8a] rounded-3xl p-6 shadow-lg mb-6 text-white relative overflow-hidden">
    <!-- Decor -->
    <div class="absolute right-0 top-0 w-32 h-32 bg-white opacity-5 rounded-bl-full"></div>
    
    <div class="relative z-10 flex items-center justify-between">
        <div>
            <p class="text-xs text-blue-200 font-bold uppercase tracking-wider mb-1">মোট রেফারেল</p>
            <h2 class="text-4xl font-bold font-mono">{{ count }} <span class="text-sm font-normal text-blue-300">জন</span></h2>
        </div>
        <div class="h-14 w-14 bg-white/10 rounded-2xl flex items-center justify-center text-2xl backdrop-blur-sm border border-white/10">
            <i class="fa-solid fa-users-line"></i>
        </div>
    </div>
</div>

<!-- Copy Link Section -->
<div class="bg-white p-5 rounded-3xl shadow-sm border border-gray-50 mb-8">
    <label class="text-xs font-bold text-gray-500 mb-2 block ml-1">আপনার ইনভাইটেশন লিংক</label>
    <div class="flex items-center gap-2 bg-gray-50 p-2 rounded-xl border border-gray-100">
        <div class="bg-[#E2136E] text-white h-10 w-10 flex items-center justify-center rounded-lg shadow-sm">
            <i class="fa-solid fa-link"></i>
        </div>
        <input type="text" id="refLink" value="..." class="bg-transparent text-sm w-full outline-none text-gray-600 font-mono" readonly>
        <button onclick="copyRef(this)" class="bg-white text-[#0A2540] px-4 py-2 rounded-lg text-xs font-bold shadow-sm border border-gray-200 hover:bg-gray-100 transition">
            কপি
        </button>
    </div>
</div>

<!-- Referral List Header -->
<div class="flex items-center justify-between mb-4 px-2">
    <h3 class="font-bold text-[#0A2540] flex items-center gap-2">
        <i class="fa-solid fa-list-ul text-[#E2136E]"></i> রেফারেল লিস্ট
    </h3>
    <span class="text-xs text-gray-400 bg-white px-3 py-1 rounded-full shadow-sm">Recent Join</span>
</div>

<!-- List Items -->
<div class="space-y-4">
    {% for ref_user in referrals %}
    <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-50 flex items-center justify-between hover:shadow-md transition group">
        
        <div class="flex items-center gap-4">
            <!-- User Icon -->
            <div class="h-12 w-12 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center text-xl shadow-sm group-hover:bg-[#E2136E] group-hover:text-white transition-colors duration-300">
                <i class="fa-regular fa-user"></i>
            </div>
            
            <div>
                <!-- Email (Masked or Name) -->
                <h4 class="font-bold text-[#0A2540] text-sm">
                    {{ ref_user.email.split('@')[0] }}
                </h4>
                <!-- Join Date -->
                <p class="text-[10px] text-gray-400 font-mono mt-0.5">
                    <i class="fa-regular fa-calendar"></i> {{ ref_user.created_at[:10] }}
                </p>
            </div>
        </div>

        <!-- Status Badge -->
        <div class="text-right">
            {% if ref_user.is_active %}
                <span class="inline-flex items-center gap-1 text-[10px] font-bold px-2 py-1 rounded-lg bg-green-50 text-green-600 border border-green-100">
                    <i class="fa-solid fa-check-circle"></i> এক্টিভ
                </span>
                <p class="text-[10px] text-gray-400 mt-1">বোনাস পেয়েছেন</p>
            {% else %}
                <span class="inline-flex items-center gap-1 text-[10px] font-bold px-2 py-1 rounded-lg bg-red-50 text-red-500 border border-red-100">
                    <i class="fa-solid fa-circle-xmark"></i> ইনএক্টিভ
                </span>
                <p class="text-[10px] text-red-300 mt-1">পেমেন্ট বাকি</p>
            {% endif %}
        </div>

    </div>
    {% else %}
    <!-- Empty State -->
    <div class="text-center py-16 bg-white rounded-3xl border border-dashed border-gray-200">
        <div class="h-16 w-16 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-3 text-3xl text-gray-300">
            <i class="fa-solid fa-user-group"></i>
        </div>
        <h3 class="text-sm font-bold text-gray-600">কাউকে রেফার করা হয়নি</h3>
        <p class="text-xs text-gray-400 mt-1">লিংক শেয়ার করে বন্ধুদের ইনভাইট করুন।</p>
    </div>
    {% endfor %}
</div>

<!-- JS for Link -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const domain = window.location.origin;
        const uniqueCode = "{{ user.referral_code if user.referral_code else 'GenerateID' }}";
        const fullLink = `${domain}/register?ref=${uniqueCode}`;
        
        const inputField = document.getElementById("refLink");
        if(inputField) {
            inputField.value = fullLink;
        }
    });

    function copyRef(btnElement) {
        const copyText = document.getElementById("refLink");
        copyText.select();
        copyText.setSelectionRange(0, 99999); 
        navigator.clipboard.writeText(copyText.value);
        
        const originalText = btnElement.innerText;
        btnElement.innerText = "কপি হয়েছে!";
        setTimeout(() => btnElement.innerText = originalText, 2000);
    }
</script>

{% endblock %}

{% extends "layout.html" %}

{% block content %}

<!-- рзз. ржкрзНрж░рзЛржлрж╛ржЗрж▓ рж╣рзЗржбрж╛рж░ (User Info) -->
<div class="bg-white rounded-2xl p-5 shadow-sm mb-5 border border-gray-100 flex items-center gap-4 relative overflow-hidden">
    <!-- Background Design -->
    <div class="absolute right-0 top-0 bg-blue-50 h-24 w-24 rounded-bl-full opacity-50"></div>

    <div class="h-16 w-16 rounded-full bg-[#0A2540] text-white flex items-center justify-center text-3xl shadow-lg border-2 border-white z-10">
        ЁЯСд
    </div>
    <div class="flex-grow z-10">
        <h2 class="text-xl font-bold text-[#0A2540]">{{ user.email.split('@')[0] }}</h2>
        <div class="flex items-center gap-2 mt-1">
            <span class="text-xs text-gray-500">ID: {{ user.referral_code if user.referral_code else 'N/A' }}</span>
            
            <!-- Status Badge -->
            <span class="text-[10px] font-bold px-2 py-0.5 rounded flex items-center gap-1
                {{ 'bg-green-100 text-green-700' if user.is_active else 'bg-red-100 text-red-700' }}">
                {{ 'тЬЕ Verified' if user.is_active else 'тЪая╕П Unverified' }}
            </span>
        </div>
    </div>
</div>

<!-- рзи. ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржХрж╛рж░рзНржб (Mini) -->
<div class="grid grid-cols-2 gap-4 mb-6">
    <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 text-center">
        <p class="text-xs text-gray-500 mb-1">ржмрж░рзНрждржорж╛ржи ржмрзНржпрж╛рж▓рзЗржирзНрж╕</p>
        <p class="text-xl font-bold text-[#E2136E]">рз│ {{ user.balance }}</p>
    </div>
    <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 text-center">
        <p class="text-xs text-gray-500 mb-1">ржорзЛржЯ ржЖрзЯ</p>
        <p class="text-xl font-bold text-[#0A2540]">рз│ {{ user.balance }}</p> <!-- Future: Add total_earnings in DB -->
    </div>
</div>

<!-- рзй. рж░рзЗржлрж╛рж░рзЗрж▓ рж╕рзЗржХрж╢ржи (Unique System) -->
<div class="bg-gradient-to-r from-[#E2136E] to-[#9c0f4d] rounded-2xl p-5 text-white shadow-lg mb-6 relative overflow-hidden">
    <!-- Decor -->
    <div class="absolute -right-6 -top-6 bg-white/20 h-32 w-32 rounded-full blur-2xl"></div>
    
    <div class="relative z-10">
        <h3 class="font-bold text-lg mb-1 flex items-center gap-2">
            ЁЯУв рж░рзЗржлрж╛рж░рзЗрж▓ ржмрзЛржирж╛рж╕
        </h3>
        <p class="text-xs text-white/90 mb-4">ржЖржкржирж╛рж░ ржЗржЙржирж┐ржХ рж▓рж┐ржВржХ рж╢рзЗрзЯрж╛рж░ ржХрж░рзБржи ржПржмржВ рзл ржЯрж╛ржХрж╛ ржмрзЛржирж╛рж╕ ржкрж╛ржи!</p>
        
        <div class="bg-white/10 backdrop-blur-sm p-1.5 rounded-lg flex items-center justify-between border border-white/20">
            <!-- Link Display -->
            <input type="text" id="refLink" 
                   value="..." 
                   class="text-white text-xs px-2 w-full outline-none bg-transparent font-mono tracking-wide" 
                   readonly>
            
            <!-- Copy Button -->
            <button onclick="copyRef(this)" class="bg-white text-[#E2136E] px-4 py-2 rounded-md text-xs font-bold hover:bg-gray-100 active:scale-95 transition shadow-sm">
                ржХржкрж┐ ржХрж░рзБржи
            </button>
        </div>
    </div>
</div>

<!-- рзк. ржорзЗржирзБ ржирзЗржнрж┐ржЧрзЗрж╢ржи (More Options) -->
<div class="bg-white rounded-2xl shadow-sm border border-gray-100 mb-6 overflow-hidden">
    
    <!-- Withdraw Money -->
    <a href="#" class="flex items-center justify-between p-4 border-b border-gray-50 hover:bg-gray-50 transition group">
        <div class="flex items-center gap-4">
            <div class="bg-blue-50 text-[#0057FF] p-2.5 rounded-xl group-hover:scale-110 transition">ЁЯТ╕</div>
            <div>
                <span class="text-[#0A2540] font-bold text-sm block">ржЯрж╛ржХрж╛ ржЙрждрзНрждрзЛрж▓ржи</span>
                <span class="text-[10px] text-gray-400">ржмрж┐ржХрж╛рж╢ / ржиржЧржж / рж░ржХрзЗржЯ</span>
            </div>
        </div>
        <span class="text-gray-300">тЭп</span>
    </a>

    <!-- History -->
    <a href="#" class="flex items-center justify-between p-4 border-b border-gray-50 hover:bg-gray-50 transition group">
        <div class="flex items-center gap-4">
            <div class="bg-purple-50 text-purple-600 p-2.5 rounded-xl group-hover:scale-110 transition">ЁЯУЬ</div>
            <div>
                <span class="text-[#0A2540] font-bold text-sm block">рж▓рзЗржиржжрзЗржи рж╣рж┐рж╕рзНржЯрзЛрж░рж┐</span>
                <span class="text-[10px] text-gray-400">рж╕ржХрж▓ ржкрзЗржорзЗржирзНржЯ ржкрзНрж░рзБржл</span>
            </div>
        </div>
        <span class="text-gray-300">тЭп</span>
    </a>

    <!-- Support Group -->
    <a href="https://t.me/your_telegram_channel" target="_blank" class="flex items-center justify-between p-4 border-b border-gray-50 hover:bg-gray-50 transition group">
        <div class="flex items-center gap-4">
            <div class="bg-sky-50 text-sky-500 p-2.5 rounded-xl group-hover:scale-110 transition">тЬИя╕П</div>
            <div>
                <span class="text-[#0A2540] font-bold text-sm block">рж╕рж╛ржкрзЛрж░рзНржЯ ржЧрзНрж░рзБржк</span>
                <span class="text-[10px] text-gray-400">ржЯрзЗрж▓рж┐ржЧрзНрж░рж╛ржорзЗ ржЬрзЯрзЗржи ржХрж░рзБржи</span>
            </div>
        </div>
        <span class="text-gray-300">тЭп</span>
    </a>

    <!-- Admin Panel (Only for Admin) -->
    {% if user.role == 'admin' %}
    <a href="/admin" class="flex items-center justify-between p-4 bg-gray-50 hover:bg-gray-100 transition border-l-4 border-[#0A2540]">
        <div class="flex items-center gap-4">
            <div class="bg-[#0A2540] text-white p-2.5 rounded-xl">тЪЩя╕П</div>
            <div>
                <span class="text-[#0A2540] font-bold text-sm block">ржПржбржорж┐ржи ржкрзНржпрж╛ржирзЗрж▓</span>
                <span class="text-[10px] text-gray-500">рж╕рж╛ржЗржЯ ржХржирзНржЯрзНрж░рзЛрж▓ рж╕рзЗржирзНржЯрж╛рж░</span>
            </div>
        </div>
        <span class="text-gray-400">тЭп</span>
    </a>
    {% endif %}
</div>

<!-- рзл. ржЯрж┐ржкрж╕ ржПржмржВ ржЧрж╛ржЗржбрж▓рж╛ржЗржи -->
<div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-5 mb-8">
    <h3 class="font-bold text-[#0A2540] mb-4 border-b pb-2 flex items-center gap-2">
        <span>ЁЯТб</span> ржХрж╛ржЬрзЗрж░ ржирж┐рзЯржорж╛ржмрж▓рж┐
    </h3>
    <ul class="space-y-3 text-sm text-gray-600">
        <li class="flex gap-3 items-start">
            <span class="text-green-500 mt-1">тЬФ</span> 
            <span>ржнрж┐ржкрж┐ржПржи (VPN) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж▓рзЗ ржПржХрж╛ржЙржирзНржЯ ржмрзНржпрж╛ржи рж╣ржмрзЗред</span>
        </li>
        <li class="flex gap-3 items-start">
            <span class="text-green-500 mt-1">тЬФ</span> 
            <span>ржкрзНрж░рждрж┐ рж░рзЗржлрж╛рж░рж▓рзЗ рззрзж% рж▓рж╛ржЗржлржЯрж╛ржЗржо ржХржорж┐рж╢ржиред</span>
        </li>
        <li class="flex gap-3 items-start">
            <span class="text-green-500 mt-1">тЬФ</span> 
            <span>ржЯрж╛ржХрж╛ ржЙрждрзНрждрзЛрж▓ржирзЗрж░ ржЬржирзНржп ржПржХрж╛ржЙржирзНржЯ ржПржХрзНржЯрж┐ржн ржерж╛ржХрждрзЗ рж╣ржмрзЗред</span>
        </li>
    </ul>
</div>

<!-- JavaScript for Dynamic Link & Copy -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // рзз. ржмрж░рзНрждржорж╛ржи ржбрзЛржорзЗржЗржи ржЕржЯрзЛржорзЗржЯрж┐ржХ ржбрж┐ржЯрзЗржХрзНржЯ ржХрж░рж╛ (Vercel/Localhost)
        const domain = window.location.origin;
        
        // рзи. ржЗржЙржЬрж╛рж░рзЗрж░ ржЗржЙржирж┐ржХ ржХрзЛржб
        const uniqueCode = "{{ user.referral_code if user.referral_code else 'GenerateID' }}";
        
        // рзй. ржкрзВрж░рзНржг рж▓рж┐ржВржХ рждрзИрж░рж┐
        const fullLink = `${domain}/register?ref=${uniqueCode}`;
        
        // рзк. ржЗржиржкрзБржЯ ржмржХрзНрж╕рзЗ рж╕рзЗржЯ ржХрж░рж╛
        const inputField = document.getElementById("refLink");
        if(inputField) {
            inputField.value = fullLink;
        }
    });

    function copyRef(btnElement) {
        const copyText = document.getElementById("refLink");
        
        // Mobile Selection Fix
        copyText.select();
        copyText.setSelectionRange(0, 99999); 

        // Copy Command
        try {
            navigator.clipboard.writeText(copyText.value).then(() => {
                showFeedback(btnElement);
            });
        } catch (err) {
            // Fallback for older browsers
            document.execCommand('copy');
            showFeedback(btnElement);
        }
    }

    function showFeedback(btn) {
        const originalText = btn.innerText;
        btn.innerText = "ржХржкрж┐ рж╣рзЯрзЗржЫрзЗ!";
        btn.classList.add("bg-green-500", "text-white");
        btn.classList.remove("text-[#E2136E]", "bg-white");
        
        setTimeout(() => {
            btn.innerText = originalText;
            btn.classList.remove("bg-green-500", "text-white");
            btn.classList.add("text-[#E2136E]", "bg-white");
        }, 2000);
    }
</script>

{% endblock %}

{% extends "layout.html" %}

{% block content %}
<div class="max-w-xl mx-auto">

    <!-- Header / Task Info -->
    <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-50 text-center mb-6 relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-[#0057FF] to-[#E2136E]"></div>
        
        <div class="h-16 w-16 bg-blue-50 text-[#0057FF] rounded-2xl flex items-center justify-center text-3xl mx-auto mb-4 shadow-sm">
            <i class="fa-solid fa-camera"></i>
        </div>
        
        <h2 class="text-2xl font-bold text-[#0A2540] mb-2">{{ task.title }}</h2>
        <p class="text-sm text-gray-500 mb-4 px-4">{{ task.description }}</p>
        
        <div class="inline-flex items-center gap-2 bg-green-50 text-green-700 px-4 py-1.5 rounded-full text-sm font-bold border border-green-100">
            <i class="fa-solid fa-gift"></i> রিওওার্ড: ৳ {{ task.reward }}
        </div>
    </div>

    <!-- Submission Form -->
    <div class="bg-white p-6 rounded-3xl shadow-lg shadow-blue-50 border border-gray-50">
        
        <!-- Step 1 -->
        <div class="mb-8">
            <div class="flex items-center gap-3 mb-3">
                <div class="h-8 w-8 bg-[#0A2540] text-white rounded-full flex items-center justify-center font-bold text-sm">১</div>
                <h3 class="font-bold text-gray-700">কাজটি সম্পন্ন করুন</h3>
            </div>
            
            <div class="bg-gray-50 p-5 rounded-2xl border border-dashed border-gray-300 text-center">
                <p class="text-xs text-gray-500 mb-3">নিচের লিংকে গিয়ে কাজটি শেষ করে একটি স্ক্রিনশট নিন</p>
                <a href="{{ task.link }}" target="_blank" class="flex items-center justify-center gap-2 w-full bg-[#0057FF] text-white py-3 rounded-xl font-bold shadow-lg shadow-blue-200 hover:bg-blue-600 active:scale-95 transition">
                    <span>লিংক ওপেন করুন</span>
                    <i class="fa-solid fa-up-right-from-square"></i>
                </a>
            </div>
        </div>

        <!-- Step 2 -->
        <!-- [UPDATED] Added onsubmit event -->
        <form method="POST" enctype="multipart/form-data" onsubmit="preventDoubleSubmit()">
            <div class="mb-8">
                <div class="flex items-center gap-3 mb-3">
                    <div class="h-8 w-8 bg-[#E2136E] text-white rounded-full flex items-center justify-center font-bold text-sm">২</div>
                    <h3 class="font-bold text-gray-700">প্রুফ জমা দিন</h3>
                </div>

                <!-- File Upload Area -->
                <div class="relative w-full group">
                    <input type="file" name="screenshot" id="fileInput" accept="image/*" required 
                           class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"
                           onchange="updateFileName(this)">
                    
                    <div id="uploadBox" class="border-2 border-dashed border-gray-300 rounded-2xl p-8 text-center transition duration-300 group-hover:border-[#E2136E] group-hover:bg-pink-50">
                        <div id="uploadIcon" class="text-4xl text-gray-300 mb-2 group-hover:text-[#E2136E] transition">
                            <i class="fa-solid fa-cloud-arrow-up"></i>
                        </div>
                        <p id="uploadText" class="text-sm font-bold text-gray-500 group-hover:text-[#E2136E]">
                            স্ক্রিনশট আপলোড করতে ট্যাপ করুন
                        </p>
                    </div>
                </div>
            </div>

            <!-- Submit Button [UPDATED ID] -->
            <button type="submit" id="submitBtn" class="w-full bg-[#0A2540] text-white py-4 rounded-xl font-bold text-lg hover:bg-opacity-90 shadow-xl active:scale-95 transition flex items-center justify-center gap-2">
                <span>জমা দিন</span>
                <i class="fa-solid fa-paper-plane"></i>
            </button>
        </form>

    </div>
</div>

<!-- Script for Interaction & Prevention -->
<script>
    // 1. File Upload UX
    function updateFileName(input) {
        const uploadBox = document.getElementById('uploadBox');
        const uploadIcon = document.getElementById('uploadIcon');
        const uploadText = document.getElementById('uploadText');

        if (input.files && input.files[0]) {
            uploadBox.classList.remove('border-gray-300', 'group-hover:bg-pink-50');
            uploadBox.classList.add('border-green-500', 'bg-green-50');
            uploadIcon.innerHTML = '<i class="fa-solid fa-circle-check text-green-500"></i>';
            uploadText.textContent = input.files[0].name;
            uploadText.classList.add('text-green-700');
        }
    }

    // 2. Prevent Double Submit Logic
    function preventDoubleSubmit() {
        const btn = document.getElementById('submitBtn');
        
        // বাটন ডিজেবল করা
        btn.disabled = true;
        btn.style.opacity = '0.7';
        btn.style.cursor = 'not-allowed';
        
        // লোডিং টেক্সট এবং স্পিনার দেখানো
        btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> আপলোড হচ্ছে... অপেক্ষা করুন';
        
        // ফর্ম সাবমিট হতে থাকবে...
        return true;
    }
</script>

{% endblock %}
